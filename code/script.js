cards_content = {
    "Utvikling": `
        <h2>Utvikling</h2>
        <h3>Moderne, responsivt design byggd for alle enheter</h3>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-code-xml-icon lucide-code-xml"><path d="m18 16 4-4-4-4"/><path d="m6 8-4 4 4 4"/><path d="m14.5 4-5 16"/></svg>
        <ul>
            <li>Responsivt design</li>
            <p> Nettsiden fungerer og ser bra ut på mobil, nettbrett og PC. </p>
            <br>
            <li>Eget kontrollpanel</li>
            <p> Du kan enkelt oppdatere innholdet selv – perfekt for menyer, blogginnlegg, produkter og mer. </p>
            <br>
            <li>Legg til / rediger / slett innhold</li>
            <p>Full kontroll over teksten og innholdet på nettsiden din – helt uten koding.</p>
            <br>
            <li>Sikker innlogging for administratorer</li>
            <p>du (eller de du gir tilgang) kan logge inn og gjøre endringer.</p>
            <br>
            <li>Valgfrie tillegg</li>
            <p> Skjemaer, animasjoner, bildegallerier, bookingsystemer og mer – tilpasses dine behov. </p>
        </ul>
            `,
    "Redesign": `
        <h2>Redesign</h2>
        <h3>Frisk opp gamle nettsider med nytt liv</h3>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-paintbrush"><path d="M14.622 17.897a2.5 2.5 0 0 0-3.52 0L2 27l3.5 3.5 9.103-9.103a2.5 2.5 0 0 0 0-3.5z"/><path d="M18 3a6 6 0 0 1 0 12h-2"/></svg>
        <ul>
            <li>Modernisering</li>
            <p>Vi gir en gammel nettside et nytt og profesjonelt utseende.</p>
            <br>
            <li>Brukervennlighet</li>
            <p>Forbedret navigasjon og struktur for å gjøre siden enklere å bruke.</p>
            <br>
            <li>Oppdatert teknologi</li>
            <p>Bygger om siden med raskere, sikrere og mer moderne løsninger.</p>
            <br>
            <li>Mer engasjerende innhold</li>
            <p>Bedre visuell stil, grafikk og interaktive elementer.</p>
        </ul>
    `,

    "Vedlikehold": `
        <h2>Vedlikehold</h2>
        <h3>Vi passer på at nettsiden din alltid fungerer</h3>
        <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-settings" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09c0-.7-.39-1.34-1-1.51a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06c.43-.43.57-1.06.33-1.82a1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09c.7 0 1.34-.39 1.51-1 .24-.76.1-1.39-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06c.43.43 1.06.57 1.82.33.61-.17 1-.81 1-1.51V3a2 2 0 1 1 4 0v.09c0 .7.39 1.34 1 1.51.76.24 1.39.1 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06c-.43.43-.57 1.06-.33 1.82.17.61.81 1 1.51 1H21a2 2 0 1 1 0 4h-.09c-.7 0-1.34.39-1.51 1z"/></svg>
        <ul>
            <li>Sikkerhetsoppdateringer</li>
            <p>Vi sørger for at alt holdes oppdatert mot trusler.</p>
            <br>
            <li>Teknisk support</li>
            <p>Hjelp når du trenger det – alt fra feilretting til små endringer.</p>
            <br>
            <li>Kontinuerlig overvåkning</li>
            <p>Vi følger med at nettsiden din alltid er oppe og går.</p>
        </ul>
    `,

    "SEO": `
        <h2>SEO</h2>
        <h3>Bli synlig i Google og andre søkemotorer</h3>
        <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-search" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <ul>
            <li>Nøkkelord</li>
            <p>Optimalisering av innhold slik at kundene finner deg på Google.</p>
            <br>
            <li>Raskere nettsider</li>
            <p>Vi forbedrer hastighet, som er viktig både for SEO og brukervennlighet.</p>
            <br>
            <li>Strukturert data</li>
            <p>Vi legger til metadata og riktig oppmerking slik at Google forstår siden bedre.</p>
            <br>
            <li>Lokal SEO</li>
            <p>Spesielt for deg som vil bli funnet av kunder i nærområdet.</p>
        </ul>
    `,

    "UX/UI": `
        <h2>UX/UI</h2>
        <h3>Design med brukeren i sentrum</h3>
        <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-layout-dashboard" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></svg>
        <ul>
            <li>Intuitiv navigasjon</li>
            <p>Nettsiden blir enkel å forstå og bruke for alle besøkende.</p>
            <br>
            <li>Visuelt hierarki</li>
            <p>Viktig innhold fremheves slik at brukeren raskt finner det de trenger.</p>
            <br>
            <li>Kundeopplevelse</li>
            <p>Designet gir et profesjonelt og tillitsvekkende inntrykk.</p>
            <br>
            <li>Tilpasning</li>
            <p>Vi skreddersyr utseendet slik at det matcher merkevaren din.</p>
        </ul>
    `
}


document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('.carousel');
    const prevBtn = document.querySelector('.carousel-btn.prev');
    const nextBtn = document.querySelector('.carousel-btn.next');
    const services = Array.from(document.querySelectorAll('.service'));
    let currentIndex = Math.floor(services.length / 2); // Start with the middle card
    let contact_img = document.getElementById("contact-side")

    function remove_img(){
        if (window.innerWidth < 769){
        contact_img.style.display = "none"
        //document.getElementsByClassName("contact-side").style.display = "none"
    }
    else{
        contact_img.style.display = "flex"
    }
    }
    // Dynamically calculate card width for responsiveness
    function getCardWidth() {
        if (services.length === 0) return 0;
        return services[0].getBoundingClientRect().width;
    }
    // Get the computed gap between cards (in px)
    function getCardGap() {
        const carouselStyles = window.getComputedStyle(carousel);
        const gap = carouselStyles.gap || carouselStyles.columnGap || '0px';
        return parseFloat(gap);
    }
    const totalCards = services.length;
    const faders = document.querySelectorAll('.fade-in');

    const options = {
    threshold: 0.2 // 0.2 = 20% of element visible
    };

    const hamburger = document.querySelector('.hamburger');
    const navLinks = document.querySelector('.nav-links');
    const navbar = document.querySelector('.navbar');

    let link_menu = false

    const dotsContainer = document.querySelector('.carousel-dots');
    // Create dots for each service
    services.forEach((service, index) => {
        const dot = document.createElement('span');
        dot.addEventListener('click', () => {
            currentIndex = index;
            updateCarousel();
        });
        dotsContainer.appendChild(dot);
    });

    function updatedots() {
        const dots = Array.from(dotsContainer.querySelectorAll('span'));
        dots.forEach((dot, index) => {
            if (index === currentIndex) {
                dot.classList.add('active');
            }
            else {
                dot.classList.remove('active');
            }
        });
    }


    hamburger.addEventListener('click', () => {
    hamburger_func()
    });

    const appearOnScroll = new IntersectionObserver(function(entries, observer) {
    entries.forEach(entry => {
        if (!entry.isIntersecting) return;
        entry.target.classList.add('show');
        observer.unobserve(entry.target); // stops watching once shown
    });
    }, options);

    faders.forEach(fader => {
    appearOnScroll.observe(fader);
    });

    function openlinks(){
        link_menu = true;

        const links = Array.from(document.querySelectorAll('.link'));

        overlay = document.createElement('div');
        overlay.classList.add('overlay-links');

        links.forEach(link => {
            div = document.createElement('div');
            div.innerHTML = link.innerHTML;

            div.addEventListener('click', () => {
                closelinks();});

            overlay.appendChild(div);
        });

        document.body.appendChild(overlay);
    }

    function closelinks() {
    link_menu = false;
    const overlay = document.querySelector('.overlay-links');
    if (overlay) {
        overlay.classList.add('exit');
        setTimeout(() => {
            overlay.remove();
        }, 300); // Match the exit animation duration
    }
}   

    function hamburger_func() {
        if (link_menu) {
            closelinks()
        }
        else {
            // Open the links overlay
            openlinks();
        }
    }

    function closeModal(overlay, modal) {

        overlay.classList.add('exit');
        modal.classList.add('exit');

        setTimeout(() => {
            overlay.remove();
        }, 300); // Match the exit animation duration1
    }

    function showModal(service) {
        const overlay = document.createElement('div');
        overlay.classList.add('overlay');

        const effect = document.createElement('div');
        effect.classList.add('mouse-effect');
        overlay.appendChild(effect);

        const modal = document.createElement('div');
        modal.classList.add('modal');

        const modalcontent = document.createElement('div');
        modalcontent.classList.add('modal-content');

        const name = service.querySelector('h3').textContent;
        modalcontent.innerHTML = cards_content[name];
        modalcontent.innerHTML += `
            <div class="close-modal-btn">Lukk</div>
        `;

        modal.appendChild(modalcontent);
        overlay.appendChild(modal);

        overlay.addEventListener('mousemove', (e) => {
            const isOverModal = modalcontent.contains(e.target);
            if (isOverModal) return;

            const trail = document.createElement('div');
            trail.classList.add('trail');
            trail.style.left = `${e.clientX}px`;
            trail.style.top = `${e.clientY}px`;
            overlay.appendChild(trail);

            setTimeout(() => {
                trail.remove();
            }, 500);
        });

        modal.querySelector('.close-modal-btn').addEventListener('click', () => {
            closeModal(overlay, modalcontent);
        });

        // ✅ Click on overlay background closes modal
        overlay.addEventListener('click', (e) => {
            const isOverModal = modalcontent.contains(e.target);
            if (isOverModal) return;
            closeModal(overlay, modalcontent);
        });

        document.body.appendChild(overlay);
    }



    
    services.forEach((service, index) => {
        service.addEventListener('click', () => {
            if (index === currentIndex) {
                // Card is already active → show modal
                showModal(service);
            } else {
                // Card is not active → scroll to it
                currentIndex = index;
                updateCarousel();
            }
        });
    });

    
    
    // Update carousel position and active state
    function updateCarousel() {
        const cardWidth = getCardWidth();
        const cardGap = getCardGap();
        // The total width of a card plus the gap
        const cardTotal = cardWidth + cardGap;
        // Center the selected card
        const translateX = -currentIndex * cardTotal + (carousel.parentElement.offsetWidth / 2) - (cardWidth / 2);
        carousel.style.transform = `translateX(${translateX}px)`;
        // Update active state
        services.forEach((service, index) => {
            service.classList.toggle('active', index === currentIndex);
        });
        updatedots();
    }
    
    // Next button click with infinite loop
    nextBtn.addEventListener('click', () => {
    currentIndex = (currentIndex + 1) % totalCards; // Loop back to 0 when reaching the end
    updateCarousel();
    });
    
    // Previous button click with infinite loop
    prevBtn.addEventListener('click', () => {
    currentIndex = (currentIndex - 1 + totalCards) % totalCards; // Loop to last when going before 0
    updateCarousel();
    });
    
    // Initialize carousel
    updateCarousel();
    
    // Handle window resize
    let resizeTimeout;
    window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
        updateCarousel();
    }, 100);
    });
    
    // Add touch/swipe support for mobile with infinite loop
    let startX = 0;
    let isDragging = false;
    
    carousel.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
    isDragging = true;
    });
      
    carousel.addEventListener('touchmove', (e) => {
    if (!isDragging) return;
    e.preventDefault();
    });
    
    carousel.addEventListener('touchend', (e) => {
    if (!isDragging) return;
    
    const endX = e.changedTouches[0].clientX;
    const diff = startX - endX;
    
    if (Math.abs(diff) > 50) { // Minimum swipe distance
        if (diff > 0) {
        // Swipe left - next (with infinite loop)
        currentIndex = (currentIndex + 1) % totalCards;
        updateCarousel();
        } else if (diff < 0) {
        // Swipe right - previous (with infinite loop)
        currentIndex = (currentIndex - 1 + totalCards) % totalCards;
        updateCarousel();
        }
    }
    
    isDragging = false;
    });
    
    // Keyboard navigation with infinite loop
    document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') {
        currentIndex = (currentIndex - 1 + totalCards) % totalCards;
        updateCarousel();
    } else if (e.key === 'ArrowRight') {
        currentIndex = (currentIndex + 1) % totalCards;
        updateCarousel();
    }
    });
    remove_img()
    window.addEventListener('resize', remove_img);
    // Optional: Auto-play functionality (uncomment to enable)
    // setInterval(() => {
    //   currentIndex = (currentIndex + 1) % totalCards;
    //   updateCarousel();
    // }, 4000); // Change slide every 4 seconds
});

